1. Настройте выполнение контрольной точки раз в 30 секунд.  
SELECT setting FROM pg_settings WHERE name = 'config_file';  
**/etc/postgresql/10/main/postgresql.conf**  
**checkpoint_timeout = 30s**  
**sudo service postgresql restart;**  
2. 10 минут c помощью утилиты pgbench подавайте нагрузку.  
**pgbench -i postgres** - инициализация тестовой базы  
**pgbench -c8 -P 60 -T 600 -U postgres postgres**  
-c кол-во пользователей  
-P раз в сек выводить прогресс  
-T секунды  
  
pgbench output:  
  
starting vacuum...end.  
progress: 60.0 s, 869.4 tps, lat 9.198 ms stddev 6.241  
progress: 120.0 s, 817.8 tps, lat 9.782 ms stddev 4.432  
progress: 180.0 s, 824.7 tps, lat 9.701 ms stddev 2.515  
progress: 240.0 s, 861.1 tps, lat 9.290 ms stddev 1.904  
progress: 300.0 s, 866.2 tps, lat 9.236 ms stddev 1.881  
progress: 360.0 s, 853.5 tps, lat 9.374 ms stddev 1.931  
progress: 420.0 s, 809.6 tps, lat 9.881 ms stddev 2.187  
progress: 480.0 s, 806.7 tps, lat 9.918 ms stddev 2.766  
progress: 540.0 s, 859.2 tps, lat 9.312 ms stddev 1.885  
progress: 600.0 s, 851.6 tps, lat 9.394 ms stddev 1.885  
transaction type: <builtin: TPC-B (sort of)>  
scaling factor: 1  
query mode: simple  
number of clients: 8  
number of threads: 1  
duration: 600 s  
number of transactions actually processed: 505189  
latency average = 9.501 ms  
latency stddev = 3.106 ms  
tps = 841.948928 (including connections establishing)  
tps = 841.952915 (excluding connections establishing)  
  
3. Измерьте, какой объем журнальных файлов был сгенерирован за это время. Оцените, какой объем приходится в среднем на одну контрольную точку.  

**cd /var/lib/postgresql/10/main/pg_wal/**  
-rw------- 1 postgres postgres 16777216 Aug  4 12:53 000000010000000000000021  
-rw------- 1 postgres postgres 16777216 Aug  4 12:54 000000010000000000000022  
-rw------- 1 postgres postgres 16777216 Aug  4 12:52 000000010000000000000023  
-rw------- 1 postgres postgres 16777216 Aug  4 12:52 000000010000000000000024  
-rw------- 1 postgres postgres 16777216 Aug  4 12:53 000000010000000000000025  
-rw------- 1 postgres postgres 16777216 Aug  4 12:52 000000010000000000000026  
**Получается, 6 файлов по 16 Мб , и того 96 Мб**  
**select from pg_stat_bgwriter;\gx**  
**checkpoints_timed     | 111**  
**Получается выполнилось 111 чекпоинтов? На один чекпоинт 96 Мб/ 111 , получается 0,86 Мб на один чекпоинт.**  
**Такое ощущение, что это неправильно, попробую посмотреть сколько точек появится после второго запуска pg_bench**
**Судя по тому что выдает select from pg_stat_bgwriter; контрольные точки реально выполняются каждые 30 сек.**
4. Проверьте данные статистики: все ли контрольные точки выполнялись точно по расписанию. Почему так произошло?  
**Возможно, точки зависят не только от настройки таймаута?**  
5. Сравните tps в синхронном/асинхронном режиме утилитой pgbench. Объясните полученный результат.  
**ALTER SYSTEM SET synchronous_commit = off;**  
**SELECT pg_reload_conf();**  
**pgbench -c8 -P 60 -T 600 -U postgres postgres**  
starting vacuum...end.
progress: 60.0 s, 1451.8 tps, lat 5.507 ms stddev 0.679
progress: 120.0 s, 1465.4 tps, lat 5.459 ms stddev 0.651
progress: 180.0 s, 1441.6 tps, lat 5.549 ms stddev 0.730
progress: 240.0 s, 1421.2 tps, lat 5.629 ms stddev 0.819
progress: 300.0 s, 1457.1 tps, lat 5.490 ms stddev 0.683
progress: 360.0 s, 1458.4 tps, lat 5.485 ms stddev 0.669
progress: 420.0 s, 1462.2 tps, lat 5.471 ms stddev 0.667
progress: 480.0 s, 1444.1 tps, lat 5.540 ms stddev 0.712
progress: 540.0 s, 1428.1 tps, lat 5.602 ms stddev 0.731
progress: 600.0 s, 1438.4 tps, lat 5.562 ms stddev 0.657
transaction type: <builtin: TPC-B (sort of)>
scaling factor: 1
query mode: simple
number of clients: 8
number of threads: 1
duration: 600 s
number of transactions actually processed: 868103
latency average = 5.529 ms
latency stddev = 0.704 ms
tps = 1446.781115 (including connections establishing)
tps = 1446.790785 (excluding connections establishing)
6. Создайте новый кластер с включенной контрольной суммой страниц. Создайте таблицу. Вставьте несколько значений.
Выключите кластер. Измените пару байт в таблице. Включите кластер и сделайте выборку из таблицы. Что и почему произошло? как проигнорировать ошибку и продолжить работу?  
